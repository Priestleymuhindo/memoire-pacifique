# graphique de visualisation
```{r importation des librairies,message=FALSE,warning=FALSE,echo=FALSE}
library(tidyverse)
library(readxl)
library(lubridate)
library(GGally)
library(ggthemes)
library(khroma)
library(ggh4x)
library(snht)
```

```{r base de données,message=FALSE,warning=FALSE,echo=FALSE}
bd <- read_excel("Inputs/bd.xlsx",sheet = "bd")
bd <- bd %>% mutate(date=ymd(date))
```


## Evolution de la  Consommation des antipaludéens 

```{r,message=FALSE,warning=FALSE,echo=FALSE}
bd_evol <- bd %>% group_by(date) %>% summarise(consommation=sum(consommation)) %>% ungroup() 
  bd_evol %>% ggplot()+
  aes(x=date,y=consommation)+
  geom_line(color="firebrick")+
  scale_x_date(
    date_labels = "%b\n%Y",
    date_breaks = "4 months",
    date_minor_breaks = "1 month",
    guide = guide_axis_minor()
  )+
  labs(x="",y="",title = "Evolution de la Consommation des anti-paludéens\n")+
  theme_clean()+
  theme(
    legend.position = "bottom"
  )
```
On peut facilement isoler ici deux périodes ,celle d'avant février 2016 et celle d'après où les tendances sont respectivement à la hausse puis à la baisse . 
Nous devons le confirmer par un test d'éxogénéité (en l'occurence de test snht)
## Test d'exogénéité pour la détection des valeurs de changement structurel

```{r,message=FALSE,warning=FALSE,echo=FALSE}
snht(bd_evol$consommation,period = 12,robust = T)
```

## Consommation des antipaludéens par tranche d'âge

```{r,message=FALSE,warning=FALSE,echo=FALSE}
bd %>% ggplot()+
  aes(x=date,y=consommation,colour=tranche_age)+
  scale_color_bright()+
  geom_line()+
  scale_x_date(
    date_labels = "%b\n%Y",
    date_breaks = "4 months",
    date_minor_breaks = "6 month",
    guide = guide_axis_minor()
  )+
  labs(x="",y="",title = "Evolution de la Consommation des anti-paludéens\n par tranche d'âge")+
  guides(color=guide_legend(title="tranche d'âge"))+
  theme_clean()+
  theme(
    legend.position = "bottom"
  )
```

